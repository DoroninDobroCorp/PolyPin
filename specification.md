# Цель

Автоматически находить расхождения цен на один и тот же **лайв-спортивный рынок** между Pinnacle и Polymarket и **покупать на Polymarket**, если там цена выгоднее на **≥12%** относительно линии Pinnacle. Для тестов — ставка **до $1**.

# Правило сравнения (приведение цен)

Чтобы сравнивать одинаковые величины, приводим обе стороны к **десятичным коэффициентам** (decimal odds):

- Pinnacle: \(O_{pin}\) — опубликованный коэффициент исхода.
- Polymarket:
  - если покупаем **YES** по цене \(p_{yes}\in(0,1)\), то эквивалентный коэффициент:
    \[
    O_{pm} = \frac{1}{p_{yes}}
    \]
  - если покупаем **NO** по цене \(p_{no}\in(0,1)\), то:
    \[
    O_{pm} = \frac{1}{\,1 - p_{no}\,}
    \]

**Триггер сделки** на соответствующем исходе:
\[
O_{pm} \;\ge\; O_{pin} \times 1.12
\]
Эквивалентно, для исполнения «с по рынку»:

- для **YES** максимальная приемлемая цена:
  \[
  p_{max} = \frac{1}{O_{pin}\times1.12}
  \]
- для **NO** максимальная приемлемая цена:
  \[
  p_{max} = 1 - \frac{1}{O_{pin}\times1.12}
  \]
Покупаем **только** ордера \( \le p_{max}\).

# Объём и лимиты

- Единичная ставка: **до $1** (тестовый максимум).
- Учитывать фактическую доступную ликвидность на ценах \( \le p_{max}\) в текущую минуту и **не превышать** ни её, ни тестовый максимум.
- Не совершать «лишних» повторных покупок: если по данному исходу в последние 2 минуты уже была покупка по цене **не хуже** текущей, новую не открывать.

# Покрытие

- Обрабатываются **все лайв-спортивные матчи** Pinnacle, по каждому матчу — все соответствующие рынки/исходы, которые корректно сопоставлены с рынками Polymarket.
- Ситуации, удовлетворяющие правилу, **не пропускаются**: цикл опроса/сравнения должен работать непрерывно с субминутной частотой.

# Логирование

Логировать для **каждой** совершённой сделки:

- **Окно времени**: с **T−60с** до **T+120с**, где **T** — момент сделки на Polymarket.
- В разрезе **обоих букмекеров** фиксировать поток изменений цен/спредов/лучших котировок (и доступный объём на лучших ценах), плюс сделку (объём, цена, исход).
- Обязательные поля записи: метка времени (UTC), источник (Pinnacle/Polymarket), идентификаторы матча и рынка с обеих сторон, тип исхода (YES/NO или конкретный исход у Pinnacle), цена, объём, статус (квотирование/сделка).

# Соответствие рынков

- Требуется **надёжное сопоставление** одинаковых исходов (например, «Team A to win» ↔ «YES: Team A wins»). Несоответствующие/неоднозначные рынки исключать из торговли до прояснения.

# Аккаунт и доступы

- Создать **отдельный аккаунт Polymarket** для этой задачи и передать нам **логин/почту и пароль**, а также данные от самой почты. Мы пополним баланс (**$10–15**).
- Использование API Polymarket **кажется разумным** (допустимо расширение Chrome или любое другое решение).

# Кодовая база (что у вас уже есть)

- **data.tar.gz** — парсер Pinnacle (продовый). Сейчас он шлёт данные в анализатор, которого у вас пока нет — **перенаправить** поток данных в ваш модуль сравнения/исполнения. Точно необходимый код.
- **main.py** — скрипт, отдающий текущие лайв-матчи Pinnacle (писался как тестовое; возможны нюансы).
- **router_for_parse** — черновой парсер цен Polymarket, также писался как тестовое; использовать по усмотрению (можно обойтись без него, если идёте через API). Наиболее непроверенный код.

# Требования к поведению

1) **Сравнивать** все лайв-рынки.  
2) Если условие выполнено — **покупать** на Polymarket в рамках лимитов.  
3) **Не покупать** вне условий и не повторять покупки без улучшения цены.  
